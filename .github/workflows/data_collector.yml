name: Collect YouTube Data

on:
  schedule:
    # Run every 6 hours (UTC times: 00:00, 06:00, 12:00, 18:00)
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      # 1. Build the Docker Image
      - name: Build Collector Image
        run: docker build -t vv-collector ./collector

      # 2. Run the Container
      - name: Run Collector Container
        run: |
          docker run --rm \
            --env YOUTUBE_API_KEY="${{ secrets.YOUTUBE_API_KEY }}" \
            --env DATABASE_URL="${{ secrets.DATABASE_URL }}" \
            vv-collector